{
    "$schema": "http://json-schema.org/draft-04/schema#",
    "__id": "https://raw.github.com/nilmtk/nilm_metadata/master/schema/meter.json",
    "title": "Meter",
    "description": "Metadata for a Meter. Uniquely idenfied within a building by meter_id",
    "allOf": [
        { "$ref": "device.json" },
        { "properties": {
            "meter_id": {
                "allOf": [
                    { "$ref": "instance.json" },
                    { "description": "The ID of this meter, unique within the building." }
                ]
            },
            "site_meter": {
                "type": "boolean",
                "description": "true if this meter measures the whole building aggregate power demand"
            },
            "data_location": {
                "type": "string",
                "description": "relative path of data"
            },
            "warning": { 
                "type": "string", 
                "description": "any issues to be aware of."
            },
            "submeter_of": { 
                "type": "integer",
                "minimum": 0,
                "description": "Either the ID of the upstream meter, or if this meter is downstream of a site meter but the precise site meter is not known then use 0. "
            },
            "sample_period": {
                "description": "The sample period in seconds",
                "type": "number",
                "minimum": 0,
                "exclusiveMinimum": true
            },
            "max_sample_period": {
                "description": "The maximum allowed sample period in seconds",
                "type": "number",
                "minimum": 0,
                "exclusiveMinimum": true
            }, 
            "measurements": {
                "type": "array",
                "items": { "$ref": "measurement.json" },
                "minItems": 1,
                "uniqueItems": true
            },
            "preprocessing_applied": {
                "type": "array",
                "items": {
                    "type": "object",
                    "oneOf": [
                        {
                            "properties": {
                                "filter": { "enum" : "clip" },
                                "minimum": { "type" : "number" },
                                "maximum": { "type" : "number" }
                            },
                            "additionalProperties": false
                        },
                        {
                            "properties": {
                                "filter": { "enum" : "gaps bookended with zeros" }
                            },
                            "additionalProperties": false
                        }
                    ]
                }
            },
            "gap_free_segments": {
                "type": "array",
                "items": { "$ref": "timeframe.json" },
                "unique": true
            },
            "contiguous_segments": {
                "type": "array",
                "items": { "$ref": "timeframe.json" },
                "unique": true
            },
            "energy": {
                "type": "array",
                "items": {
                    "allOf": [ 
                        { "$ref": "timeframe.json" },
                        { "properties": {
                            "active": { "type": "number" },
                            "reactive": { "type": "number" },
                            "apparent": { "type": "number" } }
                        }
                    ]
                }
            },
            "wireless": { "type": "boolean" },
            "wireless_base": { "$ref": "device.json" },
            "data_logger": { "$ref": "device.json" }
        }
        }
    ]
}
