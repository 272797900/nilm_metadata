{
    "$schema": "http://json-schema.org/draft-04/schema#",
    "id": "https://raw.github.com/nilmtk/nilm_metadata/master/schema/appliance.json",
    "title": "Appliance",
    "description": "Metadata for a Appliances",
    "type": "object",
    "allOf": [ { "$ref": "#/superclass" },  { "$ref": "#/one_subclass" } ],

    "superclass": {            
        "properties": {
            "instance": { "$ref": "instance.json" },
            "room_id": { "$ref": "room.json" },
            "manufacturer": { "type": "string" },
            "model": { "type": "string" },
            "meter_ids": { 
                "type": "array", 
                "items": { "$ref": "instance.json" },
                "unique": true,
                "description": "An array of the meter ID(s) used to monitor this appliance."
            },
            "on_power_threshold": { 
                "type": "number", 
                "description": "watts", 
                "minimum": 0
            },
            "minimum_off_duration": { "type": "number", "description": "seconds" },
            "minimum_on_duration": { "type": "number", "description": "seconds" },
            "dates_active": {
                "type": "array",
                "items": { "$ref": "timeframe.json" }
            },
            "control": { 
                "type": "array",
                "items": { "enum": [ 
                    "timer", "manual", "motion sensor", "light sensor",
                    "temperature sensor"] },
                "description": "Give a list of all control methods which apply.  For example, a video recorder would be both 'manual' and 'timer'."
            },
            "energy_rating": { "type": "string" },
            "nominal_power": { 
                "type": "number",
                "miniumum": 0,
                "exclusiveMinimum": true,
                "description": "active power in watts" 
            },
            "images": { 
                "type": "array", 
                "items": { "type": "string", "format": "uri" } 
            },
            "distributions": {
                "type": "object",
                "description": "Distributions of the data expressed as normalised frequencies over discrete intervals (bins).",
                "properties": {
                    "on_power": { 
                        "type": "string",
                        "description": "e.g. '0:0.0, 1:0.5, 2:0.25, 3:0.25, 4:0' meaning the bin from [0,1) has 0 mass; the bin [1,2) has 0.5 mass etc. Watts"
                    },
                    "on_duration": { 
                        "type": "string",
                        "description": "e.g. '0:0.2, 100:0.1, 200:0.0, ...'. Meaning the bin from [0,100) seconds has 0.2 mass, the bin from [100,200) has 0.1 mass etc"
                    },
                    "daily_usage": { 
                        "type": "string",
                        "description": "e.g. 'mon:0.2, tue:0.1, wed:0.0, ...'"
                    },
                    "weekly_usage": { "type": "string" },
                    "monthly_usage": { "type": "string" },
                    "rooms": { 
                        "type": "string",
                        "description": "Distribution over the rooms where this appliance is likely to be used. e.g. for a fridge this might be 'kitchen:0.9, garage:0.1'"
                    }
                }
            }
        },
        "required": ["name"]
    },

    "one_subclass": {
        "oneOf": [
                { "$ref": "#/subclasses/fridge" },
                { "$ref": "#/subclasses/screen" },
                { "$ref": "#/subclasses/games_console" },
                { "$ref": "#/subclasses/projector" },
                { "$ref": "#/subclasses/av_source" },
                { "$ref": "#/subclasses/amp" },
                { "$ref": "#/subclasses/cooker" },
                { "$ref": "#/subclasses/oven" },
                { "$ref": "#/subclasses/hob_or_grill" },
                { "$ref": "#/subclasses/sockets_and_room_specific_misc" },
                { "$ref": "#/subclasses/heating" },
                { "$ref": "#/subclasses/heat_pump" },
                { "$ref": "#/subclasses/shower_or_tub" },
                { "$ref": "#/subclasses/pump" },
                { "$ref": "#/subclasses/fan" },
                { "$ref": "#/subclasses/printer" },
                { "$ref": "#/subclasses/office" },
                { "$ref": "#/subclasses/charger" },
                { "$ref": "#/subclasses/lighting" },
                { "$ref": "#/subclasses/misc" }
        ]
    },
   
    "subclasses": {

        "fridge": {   
            "allOf": 
            [
                {
                    "properties": {
                        "type": { "enum": ["upright", "chest", "american"] }
                    }
                },

                {
                    "oneOf": [
                        {
                            "properties": {
                                "name": { "enum": ["fridge freezer", "freezer"] },
                                "freezer_is_separate_thermal_zone": { 
                                    "type": "boolean" 
                                }
                            }
                        },
                        {
                            "properties": {
                                "name": { "enum": ["fridge"] }
                            }
                        }
                    ]
                }
            ]
        },

        "screen": {   
            "properties": {
                "name": { "enum": ["tv", "computer monitor"] },
                "screen_size": { 
                    "type": "number",
                    "description": "diagonal size in inches",
                    "minimum": 0,
                    "exclusiveMinimum": true
                },
                "display": { "enum": ["crt", "lcd", "plasma", "oled" ] },
                "backlight": { "enum": ["led", "cold cathode"] }
            }
        },

        "projector": {
            "properties": {
                "name": { "enum": ["projector"] }
            }
        },

        "games_console": {
            "properties": {
                "name": { "enum": ["games console"] },
                "model": { 
                    "enum": [
                        "xbox", "xbox 360", "xbox one",
                        "ps1", "ps2", "ps3", "ps4", 
                        "wii", "wii u", 
                        "steam box" 
                    ] 
                }
            }
        },        

        "av_source": {
            "properties": {
                "name": { "enum": ["av source"] },
                "sources": {
                    "type": "array",
                    "items": { 
                        "enum": [
                            "hard disk", "receiver", "dvd", "blu-ray",
                            "videodisc", "tape", "cd", "analogue radio", 
                            "digital radio", "satellite", "cable", 
                            "broadband", "fibre"
                        ]
                    }
                }
            }
        },     

        "amp": {
            "properties": {
                "name": { "enum": ["amp"] },
                "type": { 
                    "enum": [
                        "av", "integrated audio", "pre", "power", "phono", 
                        "active sub", "active speaker"
                    ]
                }
            }
        },     

        "cooker": {
            "properties": {
                "name": { "enum": ["cooker"] },
                "components": { 
                    "type": "array",
                    "description": "meta-appliance made up of other appliances",
                    "items": {
                        "anyOf": [
                            { "$ref": "#/subclasses/oven" },
                            { "$ref": "#/subclasses/hob_or_grill" }
                        ]
                    }
                }
            }
        },

        "oven": {
            "properties": {
                "name": { "enum": ["oven"] },
                "fan": { "type": "boolean" },
                "fuel": { "$ref": "#/definitions/fuel" }
            }
        },

        "hob_or_grill": {
            "properties": {
                "name": { "enum": ["hob", "grill"] },
                "fuel": { "$ref": "#/definitions/fuel" }
            }
        },

        "sockets_and_room_specific_misc": {
            "properties": {
                "name": { "enum": ["sockets", "misc"] }
            },
            "required": ["name", "room_id"]
        },

        "heating": {
            "properties": {
                "name": { "enum": [ 
                    "boiler", "space heater", "storage heater",
                    "water heater", "swimming pool heater" ] },
                "fuel": { "$ref": "#/definitions/fuel" }
            }
        },

        "heat_pump": {
            "properties": {
                "name": { "enum": ["heat pump", "air conditioning" ] },
                "heat_source": { "enum": ["ground", "air", "water"] }
            }
        },

        "shower_or_tub": {
            "properties": {
                "name": { "enum": ["shower", "hot tub", "jacuzzi"] },
                "components": { 
                    "type": "array",
                    "description": "meta-appliance made up of other appliances",
                    "items": {
                        "anyOf": [
                            { "$ref": "#/subclasses/heating" },
                            { "$ref": "#/subclasses/pump" }
                        ]
                    }
                }
            }
        },

        "pump": {
            "properties": {
                "name": { "enum": ["pump"] },
                "type": { 
                    "enum": [
                        "shower", "swimming pool", "acquarium", "pond"] }
            }
        },

        "fan": {
            "properties": {
                "name": { "enum": ["fan"] },
                "type": { 
                    "enum": [
                        "desktop", "ceiling", "extractor" ] }
            }
        },

        "printer": {
            "properties": {
                "name": { "enum": ["printer"] },
                "type": { "enum": ["laser", "led", "ink jet", "dot matrix"] },
                "components": { 
                    "type": "array",
                    "description": "meta-appliance made up of other appliances",
                    "items": {
                        "anyOf": [
                            { "$ref": "#/subclasses/office" }
                        ]
                    }
                }
            }
        },

        "office": {
            "properties": {
                "name": { "enum": ["scanner", "fax", "photocopier"] }
            }
        },

        "charger": {
            "properties": {
                "name": { "enum": ["charger"] },
                "type": { "enum": ["mobile phone", "tablet", "ebook", 
                                   "baby hoover", "cordless phone"] }
            }
        },

        "lighting": {   
            "description": "we distinguish between the 'luminaire' (light fitting) and the electric lamp(s) within the light fitting.  See https://en.wikipedia.org/wiki/Luminaire and https://en.wikipedia.org/wiki/Lamp_%28electrical_component%29",
            "allOf": 
            [
                {
                    "properties": {
                        "name": { "enum": ["light"] },
                        "dimmable": { "type": "boolean" },
                        "dimmer_type": { 
                            "type": "string",
                            "description": "see https://en.wikipedia.org/wiki/Dimmer#Types_of_dimmer"
                        },
                        "number_of_dimmer_levels": { 
                            "type": "integer",
                            "description": "some dimmers have, say, 5 discrete levels.  If this dimmer is constinuously variable then do not specify a number_of_dimmer_levels.",
                            "minimum": 0, 
                            "exclusiveMinimum": true
                        },
                        "fixture_type": { 
                            "enum": [ 
                                "ceiling", "wall", "table", "floor standing", 
                                "floor level", "decoration", "night light", 
                                "signage", "outdoor" ] 
                        },
                        "nominal_power_per_lamp": { 
                            "type": "number", 
                            "minimum": 0, 
                            "exclusiveMinimum": true,
                            "description": "active power in watts" 
                        },
                        "number_of_lamps_in_fixture": {
                            "type": "integer",
                            "minimum": 0, 
                            "exclusiveMinimum": true
                        }
                    }
                },

                {
                    "oneOf": [
                        {
                            "properties": {
                                "lamp_type": { "enum": ["incandescent"] },
                                "lamp_subtype": { "enum": [
                                    "halogen", "tungsten"] }
                            }
                        },
                        {
                            "properties": {
                                "lamp_type": { "enum": ["led"] }
                            }
                        },
                        {
                            "properties": {
                                "lamp_type": { "enum": ["fluorescent"] },
                                "lamp_subtype": { "enum": [
                                    "linear", "compact", "cold cathode"] }
                            }
                        },

                        {
                            "properties": {
                                "lamp_type": { "enum": ["arc"] }
                            }
                        },

                        {
                            "properties": {
                                "lamp_type": { "enum": ["gas discharge"] },
                                "lamp_subtype": { "enum": [
                                    "mercury-vapor", "metal-halide", 
                                    "sodium-vapor", "neon"] }
                            }
                        }
                    ]
                }
            ]
        },


        "misc": {
            "properties": {
                "name": { "enum": [
                    "spin dryer", "tumble dryer", "washing machine", 
                    "washer dryer", "dish washer", "wine cooler", "food mixer", 
                    "vacuum cleaner", "yoghurt maker", "water filter",
                    "microwave", "kettle", "toaster", "fryer", "bread maker", 
                    "coffee maker", "food steamer", "bottle warmer", 
                    "steriliser", "plate warmer", "slow cooker", 
                    "other cooking", "dehumidifyer",

                    "rf booster", "video sender", "digital picture frame",

                    "hair dryer", "hair straightener", "trouser press", 
                    "sun bed", "electric blanket", 
                    "baby monitor rx", "baby monitor tx", "clothes iron",

                    "broadband router", "wifi base station", 
                    "ethernet hub", "usb hub", "modem",
                    "laptop computer", "desktop computer",
                    "external hard drive", "ups", "paper shredder",

                    "musical instrument",

                    "soldering iron", "drill", "saw", "sewing machine",
                    "lawn sprinkler",

                    "motorised chair", "massage bed",

                    "door bell", "security alarm", "fire alarm",

                    "electric vehicle"
                ] }
            }
        }

    },
    "definitions": {
        "fuel": { "enum": [ "electricity", "gas", "oil", 
                            "coal", "wood", "biomass" ] }
    }
}
